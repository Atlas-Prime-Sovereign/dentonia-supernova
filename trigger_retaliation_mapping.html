<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trigger-Retaliation Mapping Network</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
            color: #e0e6ed;
            padding: 20px;
            overflow-x: hidden;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 30px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        h1 {
            font-size: 2.3em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #4facfe, #00f2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .info-panel {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .network-container {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            height: 800px;
            position: relative;
        }
        .node-trigger {
            fill: #4facfe;
            stroke: #00f2fe;
            stroke-width: 2px;
        }
        .node-retaliation {
            fill: #ff6b6b;
            stroke: #ff9f43;
            stroke-width: 2px;
        }
        .link {
            stroke: rgba(255,255,255,0.3);
            stroke-width: 2px;
        }
        .node-label {
            fill: #e0e6ed;
            font-size: 12px;
            font-weight: bold;
            pointer-events: none;
            text-anchor: middle;
        }
        .legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .legend-circle {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }
        .enhancement-note {
            background: #5cd85a;
            color: #0a0e27;
            padding: 10px 20px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 10px;
            font-weight: bold;
        }
        .mapping-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .mapping-table th {
            background: rgba(79,172,254,0.2);
            padding: 12px;
            text-align: left;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .mapping-table td {
            padding: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .mapping-table tr:hover {
            background: rgba(255,255,255,0.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”— Trigger-Retaliation Mapping Network</h1>
            <div style="color: #8892b0; margin-top: 10px;">Direct Causal Links Between Democratic Actions and Institutional Response</div>
            <div class="enhancement-note">âœ¨ ENHANCEMENT #1: Explicit Mapping Table</div>
        </header>

        <div class="info-panel">
            <h3 style="margin-bottom: 15px;">New Triggers & Direct Retaliations</h3>
            <table class="mapping-table">
                <thead>
                    <tr>
                        <th>Trigger ID</th>
                        <th>Date</th>
                        <th>Action</th>
                        <th>Classification</th>
                        <th>Direct Retaliations</th>
                    </tr>
                </thead>
                <tbody id="mappingTableBody"></tbody>
            </table>
        </div>

        <div class="network-container">
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-circle" style="background: #4facfe; border: 2px solid #00f2fe;"></div>
                    <span>Triggers (Democratic Actions)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-circle" style="background: #ff6b6b; border: 2px solid #ff9f43;"></div>
                    <span>Retaliations (Institutional Response)</span>
                </div>
            </div>
            <svg id="networkGraph" width="100%" height="100%"></svg>
        </div>
    </div>

    <script>
        const mappingData = [{"trigger_id": 29, "date": "2025-11-03", "description": "Notice issued for termination consideration meeting", "classification": "Democratic/procedural action - notice of board action", "direct_retaliations": [57]}, {"trigger_id": 30, "date": "2025-11-18", "description": "Meeting rescheduled - continued participation despite intimidation", "classification": "Exercise of rights - attendance at board meeting", "direct_retaliations": [58]}, {"trigger_id": 26, "date": "2025-01-15", "description": "Nagy consultation process initiated", "classification": "Democratic oversight - external expert engagement", "direct_retaliations": [61]}, {"trigger_id": 27, "date": "2024-07-15", "description": "Dean membership inquiry", "classification": "Rights exercise - inquiry about unit access", "direct_retaliations": [62]}, {"trigger_id": 28, "date": "2023-12-01", "description": "Financial transparency demands", "classification": "Oversight action - request for financial records", "direct_retaliations": [63, 64]}];
        const retaliationData = [{"id": 57, "date": "2025-11-03", "event": "Meeting cancelled last-minute", "target": "Sean Manners", "classification": "Psychological harassment via uncertainty", "evidence": "User disclosure - Nov 2025", "legal_significance": "Process weaponization", "trigger_link": 29}, {"id": 58, "date": "2025-11-18", "event": "Michael Hackl ambush (no written follow-up)", "target": "Sean Manners", "classification": "Procedural ambush; denial of natural justice", "evidence": "User disclosure - Nov 2025", "legal_significance": "No written reasons, no appeal pathway", "trigger_link": 30}, {"id": 59, "date": "2025-11", "event": "Audit completed but withheld", "target": "All members", "classification": "Information suppression", "evidence": "User disclosure - Nov 2025", "legal_significance": "CCA s.49 violation - 21 months overdue", "trigger_link": 28}, {"id": 60, "date": "2025-11", "event": "Election info circulated while audit withheld", "target": "All members", "classification": "Strategic narrative control", "evidence": "User disclosure - Nov 2025", "legal_significance": "Legitimacy theater while concealing finances", "trigger_link": 28}, {"id": 61, "date": "2025-01", "event": "Stedmond excluded from Nagy/CHFT consultations", "target": "Stedmond Manners", "classification": "Information isolation", "evidence": "Network doc - Nagy consulted only Mary Ann Hannant & Sarah", "legal_significance": "Selective exclusion of co-director from governance process", "trigger_link": 26, "edge_case_justification": "This is retaliation because Stedmond was excluded specifically after challenging board decisions. The Nagy consultation was about governance issues he raised, yet he was deliberately excluded from the process while other board members participated. Timing and selective exclusion demonstrate retaliatory intent."}, {"id": 62, "date": "2024-08-01", "event": "Unauthorized entries to Dean's unit", "target": "Dean", "classification": "Property violation; testing enforcement boundaries", "evidence": "Timeline v2.3a entry #41", "legal_significance": "Trespass at night (CC s.177)", "trigger_link": 27, "edge_case_justification": "This event is classified as retaliation rather than general misconduct because: (1) Timing - occurred after Dean's membership inquiry and questions about access protocols; (2) Target - Dean was specifically identified as questioning board authority; (3) Pattern - part of broader boundary-testing campaign against members who raised procedural concerns; (4) Context - unauthorized entry served to intimidate and demonstrate board's willingness to violate member rights when challenged."}, {"id": 63, "date": "2024-01", "event": "Audited statements withheld (12 months overdue)", "target": "All members", "classification": "Financial transparency obstruction", "evidence": "Network doc - 18+ month withholding documented", "legal_significance": "CCA s.49(1) - must present within 6 months of fiscal year end", "trigger_link": 28}, {"id": 64, "date": "2023-01", "event": "BCA study commissioned after Agency coordination", "target": "All members", "classification": "Crisis manufacture", "evidence": "Network doc - Helen's 'really long conversation with Agency'", "legal_significance": "Coordinated external pressure to manufacture housing crisis", "trigger_link": 28}, {"id": 65, "date": "2025-02-19", "event": "Ballot destruction by Bernice (within 1 week of GMM)", "target": "All members", "classification": "Spoliation of evidence", "evidence": "Network doc admission - ballots destroyed within one week", "legal_significance": "CC s.430 (Mischief to election property)", "trigger_link": 30}];

        // Populate table
        const tbody = document.getElementById('mappingTableBody');
        mappingData.forEach(trigger => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td><strong>T-${trigger.trigger_id}</strong></td>
                <td>${trigger.date}</td>
                <td>${trigger.description}</td>
                <td style="color: #4facfe;">${trigger.classification}</td>
                <td><strong style="color: #ff6b6b;">R-${trigger.direct_retaliations.join(', R-')}</strong></td>
            `;
        });

        // Create network graph
        const svg = d3.select('#networkGraph');
        const width = svg.node().getBoundingClientRect().width;
        const height = svg.node().getBoundingClientRect().height;

        // Prepare nodes and links
        const nodes = [];
        const links = [];

        // Add trigger nodes
        mappingData.forEach(trigger => {
            nodes.push({
                id: `T${trigger.trigger_id}`,
                label: `Trigger ${trigger.trigger_id}`,
                type: 'trigger',
                description: trigger.description
            });

            // Add retaliation nodes and links
            trigger.direct_retaliations.forEach(retId => {
                const ret = retaliationData.find(r => r.id === retId);
                if (ret) {
                    nodes.push({
                        id: `R${retId}`,
                        label: `Retaliation ${retId}`,
                        type: 'retaliation',
                        description: ret.event
                    });

                    links.push({
                        source: `T${trigger.trigger_id}`,
                        target: `R${retId}`
                    });
                }
            });
        });

        // Remove duplicate nodes
        const uniqueNodes = Array.from(new Set(nodes.map(n => n.id)))
            .map(id => nodes.find(n => n.id === id));

        // Create force simulation
        const simulation = d3.forceSimulation(uniqueNodes)
            .force('link', d3.forceLink(links).id(d => d.id).distance(150))
            .force('charge', d3.forceManyBody().strength(-500))
            .force('center', d3.forceCenter(width / 2, height / 2))
            .force('collision', d3.forceCollide().radius(60));

        // Draw links
        const link = svg.append('g')
            .selectAll('line')
            .data(links)
            .enter()
            .append('line')
            .attr('class', 'link');

        // Draw nodes
        const node = svg.append('g')
            .selectAll('circle')
            .data(uniqueNodes)
            .enter()
            .append('circle')
            .attr('r', d => d.type === 'trigger' ? 25 : 20)
            .attr('class', d => d.type === 'trigger' ? 'node-trigger' : 'node-retaliation')
            .call(d3.drag()
                .on('start', dragstarted)
                .on('drag', dragged)
                .on('end', dragended));

        // Add labels
        const label = svg.append('g')
            .selectAll('text')
            .data(uniqueNodes)
            .enter()
            .append('text')
            .attr('class', 'node-label')
            .attr('dy', d => d.type === 'trigger' ? -30 : -25)
            .text(d => d.label);

        // Add tooltips
        node.append('title')
            .text(d => d.description);

        // Update positions
        simulation.on('tick', () => {
            link
                .attr('x1', d => d.source.x)
                .attr('y1', d => d.source.y)
                .attr('x2', d => d.target.x)
                .attr('y2', d => d.target.y);

            node
                .attr('cx', d => d.x)
                .attr('cy', d => d.y);

            label
                .attr('x', d => d.x)
                .attr('y', d => d.y);
        });

        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }
    </script>
</body>
</html>